{"ast":null,"code":"const vary = require('vary');\n\n/**\n * CORS middleware\n *\n * @param {Object} [options]\n *  - {String|Function(ctx)} origin `Access-Control-Allow-Origin`, default is '*'\n *    If `credentials` set and return `true, the `origin` default value will set to the request `Origin` header\n *  - {String|Array} allowMethods `Access-Control-Allow-Methods`, default is 'GET,HEAD,PUT,POST,DELETE,PATCH'\n *  - {String|Array} exposeHeaders `Access-Control-Expose-Headers`\n *  - {String|Array} allowHeaders `Access-Control-Allow-Headers`\n *  - {String|Number} maxAge `Access-Control-Max-Age` in seconds\n *  - {Boolean|Function(ctx)} credentials `Access-Control-Allow-Credentials`\n *  - {Boolean} keepHeadersOnError Add set headers to `err.header` if an error is thrown\n *  - {Boolean} secureContext `Cross-Origin-Opener-Policy` & `Cross-Origin-Embedder-Policy` headers.', default is false\n *    @see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/SharedArrayBuffer/Planned_changes\n *  - {Boolean} privateNetworkAccess handle `Access-Control-Request-Private-Network` request by return `Access-Control-Allow-Private-Network`, default to false\n *    @see https://wicg.github.io/private-network-access/\n * @return {Function} cors middleware\n * @public\n */\nmodule.exports = function (options) {\n  const defaults = {\n    allowMethods: 'GET,HEAD,PUT,POST,DELETE,PATCH',\n    secureContext: false\n  };\n  options = {\n    ...defaults,\n    ...options\n  };\n  if (Array.isArray(options.exposeHeaders)) {\n    options.exposeHeaders = options.exposeHeaders.join(',');\n  }\n  if (Array.isArray(options.allowMethods)) {\n    options.allowMethods = options.allowMethods.join(',');\n  }\n  if (Array.isArray(options.allowHeaders)) {\n    options.allowHeaders = options.allowHeaders.join(',');\n  }\n  if (options.maxAge) {\n    options.maxAge = String(options.maxAge);\n  }\n  options.keepHeadersOnError = options.keepHeadersOnError === undefined || !!options.keepHeadersOnError;\n  return async function cors(ctx, next) {\n    // If the Origin header is not present terminate this set of steps.\n    // The request is outside the scope of this specification.\n    const requestOrigin = ctx.get('Origin');\n\n    // Always set Vary header\n    // https://github.com/rs/cors/issues/10\n    ctx.vary('Origin');\n    let origin;\n    if (typeof options.origin === 'function') {\n      origin = await options.origin(ctx);\n      if (!origin) {\n        return await next();\n      }\n    } else {\n      origin = options.origin || '*';\n    }\n    let credentials;\n    if (typeof options.credentials === 'function') {\n      credentials = await options.credentials(ctx);\n    } else {\n      credentials = !!options.credentials;\n    }\n    if (credentials && origin === '*') {\n      origin = requestOrigin;\n    }\n    const headersSet = {};\n    function set(key, value) {\n      ctx.set(key, value);\n      headersSet[key] = value;\n    }\n    if (ctx.method !== 'OPTIONS') {\n      // Simple Cross-Origin Request, Actual Request, and Redirects\n      set('Access-Control-Allow-Origin', origin);\n      if (credentials === true) {\n        set('Access-Control-Allow-Credentials', 'true');\n      }\n      if (options.exposeHeaders) {\n        set('Access-Control-Expose-Headers', options.exposeHeaders);\n      }\n      if (options.secureContext) {\n        set('Cross-Origin-Opener-Policy', 'same-origin');\n        set('Cross-Origin-Embedder-Policy', 'require-corp');\n      }\n      if (!options.keepHeadersOnError) {\n        return await next();\n      }\n      try {\n        return await next();\n      } catch (err) {\n        const errHeadersSet = err.headers || {};\n        const varyWithOrigin = vary.append(errHeadersSet.vary || errHeadersSet.Vary || '', 'Origin');\n        delete errHeadersSet.Vary;\n        err.headers = {\n          ...errHeadersSet,\n          ...headersSet,\n          ...{\n            vary: varyWithOrigin\n          }\n        };\n        throw err;\n      }\n    } else {\n      // Preflight Request\n\n      // If there is no Access-Control-Request-Method header or if parsing failed,\n      // do not set any additional headers and terminate this set of steps.\n      // The request is outside the scope of this specification.\n      if (!ctx.get('Access-Control-Request-Method')) {\n        // this not preflight request, ignore it\n        return await next();\n      }\n      ctx.set('Access-Control-Allow-Origin', origin);\n      if (credentials === true) {\n        ctx.set('Access-Control-Allow-Credentials', 'true');\n      }\n      if (options.maxAge) {\n        ctx.set('Access-Control-Max-Age', options.maxAge);\n      }\n      if (options.privateNetworkAccess && ctx.get('Access-Control-Request-Private-Network')) {\n        ctx.set('Access-Control-Allow-Private-Network', 'true');\n      }\n      if (options.allowMethods) {\n        ctx.set('Access-Control-Allow-Methods', options.allowMethods);\n      }\n      if (options.secureContext) {\n        set('Cross-Origin-Opener-Policy', 'same-origin');\n        set('Cross-Origin-Embedder-Policy', 'require-corp');\n      }\n      let allowHeaders = options.allowHeaders;\n      if (!allowHeaders) {\n        allowHeaders = ctx.get('Access-Control-Request-Headers');\n      }\n      if (allowHeaders) {\n        ctx.set('Access-Control-Allow-Headers', allowHeaders);\n      }\n      ctx.status = 204;\n    }\n  };\n};","map":{"version":3,"names":["vary","require","module","exports","options","defaults","allowMethods","secureContext","Array","isArray","exposeHeaders","join","allowHeaders","maxAge","String","keepHeadersOnError","undefined","cors","ctx","next","requestOrigin","get","origin","credentials","headersSet","set","key","value","method","err","errHeadersSet","headers","varyWithOrigin","append","Vary","privateNetworkAccess","status"],"sources":["C:/Users/ytBad/OneDrive/바탕 화면/all/project/my-app/node_modules/@koa/cors/index.js"],"sourcesContent":["const vary = require('vary');\n\n/**\n * CORS middleware\n *\n * @param {Object} [options]\n *  - {String|Function(ctx)} origin `Access-Control-Allow-Origin`, default is '*'\n *    If `credentials` set and return `true, the `origin` default value will set to the request `Origin` header\n *  - {String|Array} allowMethods `Access-Control-Allow-Methods`, default is 'GET,HEAD,PUT,POST,DELETE,PATCH'\n *  - {String|Array} exposeHeaders `Access-Control-Expose-Headers`\n *  - {String|Array} allowHeaders `Access-Control-Allow-Headers`\n *  - {String|Number} maxAge `Access-Control-Max-Age` in seconds\n *  - {Boolean|Function(ctx)} credentials `Access-Control-Allow-Credentials`\n *  - {Boolean} keepHeadersOnError Add set headers to `err.header` if an error is thrown\n *  - {Boolean} secureContext `Cross-Origin-Opener-Policy` & `Cross-Origin-Embedder-Policy` headers.', default is false\n *    @see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/SharedArrayBuffer/Planned_changes\n *  - {Boolean} privateNetworkAccess handle `Access-Control-Request-Private-Network` request by return `Access-Control-Allow-Private-Network`, default to false\n *    @see https://wicg.github.io/private-network-access/\n * @return {Function} cors middleware\n * @public\n */\nmodule.exports = function(options) {\n  const defaults = {\n    allowMethods: 'GET,HEAD,PUT,POST,DELETE,PATCH',\n    secureContext: false,\n  };\n\n  options = {\n    ...defaults,\n    ...options,\n  };\n\n  if (Array.isArray(options.exposeHeaders)) {\n    options.exposeHeaders = options.exposeHeaders.join(',');\n  }\n\n  if (Array.isArray(options.allowMethods)) {\n    options.allowMethods = options.allowMethods.join(',');\n  }\n\n  if (Array.isArray(options.allowHeaders)) {\n    options.allowHeaders = options.allowHeaders.join(',');\n  }\n\n  if (options.maxAge) {\n    options.maxAge = String(options.maxAge);\n  }\n\n  options.keepHeadersOnError = options.keepHeadersOnError === undefined || !!options.keepHeadersOnError;\n\n  return async function cors(ctx, next) {\n    // If the Origin header is not present terminate this set of steps.\n    // The request is outside the scope of this specification.\n    const requestOrigin = ctx.get('Origin');\n\n    // Always set Vary header\n    // https://github.com/rs/cors/issues/10\n    ctx.vary('Origin');\n\n    let origin;\n    if (typeof options.origin === 'function') {\n      origin = await options.origin(ctx);\n      if (!origin) {\n        return await next();\n      }\n    } else {\n      origin = options.origin || '*';\n    }\n\n    let credentials;\n    if (typeof options.credentials === 'function') {\n      credentials = await options.credentials(ctx);\n    } else {\n      credentials = !!options.credentials;\n    }\n\n    if (credentials && origin === '*') {\n      origin = requestOrigin;\n    }\n\n    const headersSet = {};\n\n    function set(key, value) {\n      ctx.set(key, value);\n      headersSet[key] = value;\n    }\n\n    if (ctx.method !== 'OPTIONS') {\n      // Simple Cross-Origin Request, Actual Request, and Redirects\n      set('Access-Control-Allow-Origin', origin);\n\n      if (credentials === true) {\n        set('Access-Control-Allow-Credentials', 'true');\n      }\n\n      if (options.exposeHeaders) {\n        set('Access-Control-Expose-Headers', options.exposeHeaders);\n      }\n\n      if (options.secureContext) {\n        set('Cross-Origin-Opener-Policy', 'same-origin');\n        set('Cross-Origin-Embedder-Policy', 'require-corp');\n      }\n\n      if (!options.keepHeadersOnError) {\n        return await next();\n      }\n      try {\n        return await next();\n      } catch (err) {\n        const errHeadersSet = err.headers || {};\n        const varyWithOrigin = vary.append(errHeadersSet.vary || errHeadersSet.Vary || '', 'Origin');\n        delete errHeadersSet.Vary;\n\n        err.headers = {\n          ...errHeadersSet,\n          ...headersSet,\n          ...{ vary: varyWithOrigin },\n        };\n        throw err;\n      }\n    } else {\n      // Preflight Request\n\n      // If there is no Access-Control-Request-Method header or if parsing failed,\n      // do not set any additional headers and terminate this set of steps.\n      // The request is outside the scope of this specification.\n      if (!ctx.get('Access-Control-Request-Method')) {\n        // this not preflight request, ignore it\n        return await next();\n      }\n\n      ctx.set('Access-Control-Allow-Origin', origin);\n\n      if (credentials === true) {\n        ctx.set('Access-Control-Allow-Credentials', 'true');\n      }\n\n      if (options.maxAge) {\n        ctx.set('Access-Control-Max-Age', options.maxAge);\n      }\n\n      if (options.privateNetworkAccess && ctx.get('Access-Control-Request-Private-Network')) {\n        ctx.set('Access-Control-Allow-Private-Network', 'true');\n      }\n\n      if (options.allowMethods) {\n        ctx.set('Access-Control-Allow-Methods', options.allowMethods);\n      }\n\n      if (options.secureContext) {\n        set('Cross-Origin-Opener-Policy', 'same-origin');\n        set('Cross-Origin-Embedder-Policy', 'require-corp');\n      }\n\n      let allowHeaders = options.allowHeaders;\n      if (!allowHeaders) {\n        allowHeaders = ctx.get('Access-Control-Request-Headers');\n      }\n      if (allowHeaders) {\n        ctx.set('Access-Control-Allow-Headers', allowHeaders);\n      }\n\n      ctx.status = 204;\n    }\n  };\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}